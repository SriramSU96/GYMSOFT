<div class="page-container fade-in">
    <!-- Action Bar -->
    <div class="page-header mb-lg no-print">
        <div>
            <h2 class="mb-xs">Invoice Detail</h2>
            <p class="text-secondary">View and download transaction receipt.</p>
        </div>
        <div class="flex gap-md">
            <button class="btn btn-secondary" (click)="printInvoice()">
                <span class="material-icons">print</span>
                <span>Print Invoice</span>
            </button>
            <button class="btn btn-primary" (click)="downloadPdf()">
                <span class="material-icons">download</span>
                <span>Download PDF</span>
            </button>
        </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error$ | async as error" class="card p-xl text-center border-danger border-opacity-20 mb-lg">
        <span class="material-icons text-danger mb-md" style="font-size: 3rem;">error_outline</span>
        <h3 class="text-danger">Failed to load invoice</h3>
        <p class="text-muted mb-lg">{{ error.message || 'The requested invoice could not be retrieved.' }}</p>
        <button class="btn btn-primary" (click)="ngOnInit()">Try Again</button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading$ | async" class="flex flex-col items-center justify-center p-xl">
        <div class="animate-spin text-accent material-icons mb-md" style="font-size: 3rem;">refresh</div>
        <p class="text-muted">Generating invoice preview...</p>
    </div>

    <!-- Invoice Content -->
    <div class="card p-xl max-w-4xl mx-auto overflow-hidden invoice-paper" *ngIf="invoice$ | async as invoice"
        style="min-height: 800px; background: var(--bg-card); position: relative;">

        <div class="invoice-accent-bar"
            style="position: absolute; top:0; left:0; right:0; height: 6px; background: var(--accent-primary);"></div>

        <!-- Header -->
        <div class="flex justify-between items-start mb-xl pb-xl border-b border-muted mt-4">
            <div>
                <div class="flex items-center gap-sm mb-md">
                    <div class="bg-accent p-2 rounded-lg">
                        <span class="material-icons text-white" style="font-size: 2rem;">fitness_center</span>
                    </div>
                    <h1 class="text-3xl font-black tracking-tighter mb-0 text-primary">GYMSOFT</h1>
                </div>
                <div class="text-muted text-sm">
                    <p class="mb-0">123 Fitness Avenue, Tech Hub</p>
                    <p class="mb-0">Silicon Valley, CA 94043</p>
                    <p class="mb-0">billing@gymsoft.com</p>
                </div>
            </div>
            <div class="text-right">
                <h2 class="text-accent mb-xs uppercase tracking-widest">Invoice</h2>
                <div class="font-mono text-xl text-primary font-bold">#{{ invoice.id }}</div>
                <div class="text-muted text-sm mt-md">
                    <div>Date: <span class="text-primary">{{ invoice.date | date:'mediumDate' }}</span></div>
                    <div class="mt-2">
                        <span class="badge" [ngClass]="invoice.status === 'paid' ? 'badge-success' : 'badge-warning'">
                            {{ (invoice.status || 'PAID') | uppercase }}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Billing Info Grid -->
        <div class="grid grid-cols-2 gap-xl mb-xl">
            <div>
                <div class="text-xs uppercase tracking-widest text-muted mb-md font-bold">Client Details:</div>
                <div class="text-xl font-bold text-primary mb-1">{{ invoice.member?.name }}</div>
                <div class="text-muted text-sm">
                    <p class="mb-0">{{ invoice.member?.email }}</p>
                    <p class="mb-0">{{ invoice.member?.address }}</p>
                    <p class="mt-2 text-xs">ID: {{ invoice.memberId }}</p>
                </div>
            </div>
            <div class="text-right">
                <div class="text-xs uppercase tracking-widest text-muted mb-md font-bold">Payment Summary:</div>
                <div class="text-lg font-bold text-primary uppercase mb-1">Membership Payment</div>
                <div class="text-muted text-sm">System Generated Invoice</div>
            </div>
        </div>

        <!-- Items Table -->
        <div class="table-container mb-xl border border-muted rounded-lg overflow-hidden">
            <table class="w-full">
                <thead class="bg-secondary bg-opacity-30 border-b border-muted">
                    <tr>
                        <th class="text-left py-4 px-6 text-xs uppercase tracking-wider text-muted font-bold">
                            Description</th>
                        <th class="text-center py-4 px-6 text-xs uppercase tracking-wider text-muted font-bold">Qty</th>
                        <th class="text-right py-4 px-6 text-xs uppercase tracking-wider text-muted font-bold">Unit
                            Price</th>
                        <th class="text-right py-4 px-6 text-xs uppercase tracking-wider text-muted font-bold">Total
                        </th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-muted">
                    <tr *ngFor="let item of (invoice.items || [])">
                        <td class="py-5 px-6">
                            <div class="font-bold text-primary">{{ item.description }}</div>
                            <div class="text-xs text-muted">Gym Services Subscription</div>
                        </td>
                        <td class="text-center py-5 px-6 text-secondary">1</td>
                        <td class="text-right py-5 px-6 text-secondary">₹{{ item.amount | number }}</td>
                        <td class="text-right py-5 px-6 font-bold text-primary">₹{{ item.amount | number }}</td>
                    </tr>
                    <!-- Default row if no items -->
                    <tr *ngIf="!invoice.items || invoice.items.length === 0">
                        <td class="py-5 px-6">
                            <div class="font-bold text-primary">Standard Membership Entry</div>
                            <div class="text-xs text-muted">Access to all gym facilities and equipment</div>
                        </td>
                        <td class="text-center py-5 px-6 text-secondary">1</td>
                        <td class="text-right py-5 px-6 text-secondary">₹{{ invoice.amount | number }}</td>
                        <td class="text-right py-5 px-6 font-bold text-primary">₹{{ invoice.amount | number }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Calculation Grid -->
        <div class="flex justify-end pt-xl">
            <div class="w-80 space-y-md">
                <div class="flex justify-between text-muted pb-md border-b border-muted border-opacity-30">
                    <span class="text-sm">Subtotal</span>
                    <span class="font-mono font-bold">₹{{ invoice.amount | number }}</span>
                </div>
                <div class="flex justify-between text-muted pb-md border-b border-muted border-opacity-30">
                    <span class="text-sm">Estimated Tax (18%)</span>
                    <span class="font-mono font-bold">₹{{ (invoice.tax || (invoice.amount * 0.18)) | number }}</span>
                </div>
                <div class="flex justify-between items-center pt-md">
                    <div class="text-lg font-black text-primary uppercase tracking-tighter">Grand Total</div>
                    <div class="text-3xl font-black text-accent tracking-tighter font-mono">
                        ₹{{ (invoice.total || (invoice.amount * 1.18)) | number }}
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes & Signature -->
        <div class="mt-auto pt-xl grid grid-cols-2 gap-xl">
            <div class="p-4 bg-secondary bg-opacity-20 rounded-lg">
                <div class="text-xs font-bold text-muted uppercase mb-2">Notes:</div>
                <p class="text-xs text-muted mb-0">Please keep this invoice for your records. Contact
                    billing@gymsoft.com for any discrepancies within 7 days.</p>
            </div>
            <div class="text-right flex flex-col justify-end">
                <div class="mb-2">
                    <div class="font-black text-lg text-primary italic">GymSoft Admin</div>
                </div>
                <div class="text-xs text-muted">Authorized Signatory</div>
            </div>
        </div>
    </div>
</div>

<style>
    @media print {
        .no-print {
            display: none !important;
        }

        .page-container {
            padding: 0 !important;
            margin: 0 !important;
        }

        .card.invoice-paper {
            box-shadow: none !important;
            border: 1px solid #ddd !important;
            width: 100% !important;
            max-width: 100% !important;
            color: black !important;
            background: white !important;
        }

        .text-primary,
        .text-accent,
        .text-muted,
        .text-secondary {
            color: black !important;
        }

        .bg-card {
            background: white !important;
        }

        .badge {
            border: 1px solid #000 !important;
            color: black !important;
            background: transparent !important;
        }

        .invoice-accent-bar {
            display: none;
        }

        * {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
    }
</style>