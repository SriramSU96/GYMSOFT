<div class="page-container fade-in flex flex-col lg:flex-row gap-lg h-[calc(100vh-100px)]">

    <!-- Product Grid (Left Side) -->
    <div class="lg:w-2/3 flex flex-col">
        <div class="page-header mb-md">
            <h2 class="mb-0">POS Terminal</h2>
        </div>

        <!-- Search/Filter could go here -->

        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-md overflow-y-auto pr-sm custom-scrollbar">
            <div *ngFor="let product of products"
                class="card cursor-pointer hover:border-[var(--accent-primary)] transition-all active:scale-95"
                (click)="addToCart(product)" [class.opacity-50]="product.stock === 0"
                [class.pointer-events-none]="product.stock === 0">

                <div class="text-xs text-muted mb-1">{{ product.category }}</div>
                <h4 class="font-bold text-sm mb-2 truncate">{{ product.name }}</h4>
                <div class="flex justify-between items-end">
                    <span class="text-accent font-mono font-bold">${{ product.price }}</span>
                    <span class="text-xs badge" [ngClass]="product.stock > 0 ? 'badge-success' : 'badge-danger'">
                        {{ product.stock > 0 ? product.stock : 'Out of Stock' }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart & Checkout (Right Side) -->
    <div class="lg:w-1/3 card flex flex-col h-full bg-[var(--bg-secondary)] border-l border-[var(--color-border)]">
        <h3 class="border-b border-[var(--color-border)] pb-md mb-md">Current Sale</h3>

        <!-- Cart Items -->
        <div class="flex-1 overflow-y-auto custom-scrollbar mb-md">
            <div *ngIf="cart.length === 0" class="text-center text-muted py-xl">
                <span class="material-icons text-4xl mb-sm">shopping_cart</span>
                <p>Cart is empty</p>
            </div>

            <div *ngFor="let item of cart"
                class="flex justify-between items-center p-sm border-b border-[var(--color-border)] hover:bg-[var(--bg-app)] transition-colors">
                <div class="flex-1">
                    <div class="font-bold text-sm">{{ item.productName }}</div>
                    <div class="text-xs text-muted">${{ item.price }} x {{ item.quantity }}</div>
                </div>
                <div class="flex items-center gap-sm">
                    <button class="btn btn-icon btn-sm" (click)="updateQuantity(item.productId, -1)">-</button>
                    <span class="font-mono">{{ item.quantity }}</span>
                    <button class="btn btn-icon btn-sm" (click)="updateQuantity(item.productId, 1)">+</button>
                    <button class="text-danger ml-sm hover:text-red-400" (click)="removeFromCart(item.productId)">
                        <span class="material-icons text-sm">delete</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Checkout Form -->
        <form [formGroup]="saleForm" (ngSubmit)="processSale()" class="mt-auto">
            <div class="bg-[var(--bg-app)] p-md rounded-md mb-md">
                <div class="flex justify-between text-lg font-bold mb-sm">
                    <span>Total</span>
                    <span class="text-success font-mono">${{ totalAmount.toFixed(2) }}</span>
                </div>

                <div class="grid grid-cols-1 gap-sm">
                    <input type="text" formControlName="customerName" placeholder="Customer Name (Optional)"
                        class="p-sm text-sm">
                    <select formControlName="paymentMethod" class="p-sm text-sm">
                        <option value="Cash">Cash</option>
                        <option value="Card">Card</option>
                        <option value="UPI">UPI</option>
                        <option value="Gym Credit">Gym Credit</option>
                    </select>
                </div>
            </div>

            <div *ngIf="successMessage"
                class="text-success text-center text-sm mb-sm bg-[var(--success-dim)] p-xs rounded">
                {{ successMessage }}
            </div>

            <button type="submit" class="btn btn-primary btn-block py-md text-lg font-bold shadow-lg shadow-red-900/20"
                [disabled]="cart.length === 0 || isLoading">
                {{ isLoading ? 'Processing...' : 'Checkout' }}
            </button>
        </form>
    </div>
</div>