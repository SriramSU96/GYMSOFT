<div class="relative inline-block text-left" *ngIf="selectedGym$ | async as selectedGym">
    <!-- Active Gym Button -->
    <button (click)="toggleDropdown()" class="flex items-center gap-sm px-lg py-sm rounded-full transition-all group"
        style="background: rgba(255,255,255,0.03); border: 1px solid rgba(212,175,55,0.1); border-radius: var(--radius-full);">
        <div
            class="flex items-center justify-center w-8 h-8 rounded-full bg-accent-soft text-accent group-hover:scale-110 transition-transform">
            <span class="material-icons" style="font-size: 1.2rem;">business</span>
        </div>
        <div class="text-left">
            <div class="text-[10px] uppercase tracking-widest text-muted font-bold leading-none mb-1">Active Branch
            </div>
            <div class="text-sm font-bold text-primary leading-none">{{ selectedGym.name }}</div>
        </div>
        <span class="material-icons text-muted transition-transform duration-300"
            [style.transform]="isDropdownOpen ? 'rotate(180deg)' : 'rotate(0deg)'">expand_more</span>
    </button>

    <!-- Glassmorphism Dropdown -->
    <div *ngIf="isDropdownOpen" class="absolute left-0 mt-3 w-72 z-50 animate-fadeIn"
        (mouseleave)="isDropdownOpen = false">
        <div class="card p-0 shadow-hover glass-dark border border-accent-soft overflow-hidden"
            *ngIf="gyms$ | async as gyms">
            <div class="p-md border-b border-subtle bg-white/5">
                <span class="text-xs font-bold uppercase tracking-wider text-muted">Switch Location</span>
            </div>

            <div class="max-h-64 overflow-y-auto custom-scrollbar">
                <button *ngFor="let gym of gyms" (click)="selectGym(gym)"
                    class="w-full flex items-center gap-md p-md hover:bg-white/5 transition-all text-left border-none group cursor-pointer"
                    [class.bg-accent-soft]="selectedGym._id === gym._id">
                    <div class="w-2 h-2 rounded-full" [class.bg-accent]="selectedGym._id === gym._id"
                        [class.bg-subtle]="selectedGym._id !== gym._id"></div>
                    <div class="flex-1">
                        <div class="text-sm font-bold" [class.text-accent]="selectedGym._id === gym._id">{{ gym.name }}
                        </div>
                        <div class="text-[11px] text-muted">{{ gym.address }}</div>
                    </div>
                    <span *ngIf="selectedGym._id === gym._id" class="material-icons text-accent"
                        style="font-size: 1.1rem;">check_circle</span>
                </button>

                <div *ngIf="gyms.length === 0" class="p-lg text-center opacity-50">
                    <p class="text-xs text-muted m-0">No other branches found.</p>
                </div>
            </div>

            <!-- Footer Action -->
            <button (click)="createGym()"
                class="w-full p-md flex items-center justify-center gap-xs py-lg hover:text-accent transition-colors bg-white/5 border-t border-subtle text-sm font-bold text-primary">
                <span class="material-icons" style="font-size: 1.1rem;">add_circle_outline</span>
                <span>Add New Branch</span>
            </button>
        </div>
    </div>
</div>

<!-- Add Branch Modal -->
<app-gym-branch-add *ngIf="isAddBranchOpen && (selectedGym$ | async) as selected" [parentGym]="selected"
    (close)="closeAddBranch()">
</app-gym-branch-add>