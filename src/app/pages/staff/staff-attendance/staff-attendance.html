<div class="page-container">
    <!-- PAGE HEADER -->
    <div class="page-header">
        <div>
            <h1 class="page-title">Staff Attendance</h1>
            <p class="page-subtitle">Track daily staff attendance and working hours</p>
        </div>
        <div class="flex items-center gap-md">
            <input type="date" [(ngModel)]="selectedDate" (change)="onDateChange()" class="date-picker" />
            <button class="btn btn-primary" (click)="saveAllAttendance()">
                <span class="material-icons">save</span>
                Save All Changes
            </button>
        </div>
    </div>

    <!-- TABS -->
    <div class="tabs-container">
        <button class="tab-btn" [class.active]="activeTab === 'today'" (click)="activeTab = 'today'">
            Today's Attendance
        </button>
        <button class="tab-btn" [class.active]="activeTab === 'history'" (click)="activeTab = 'history'">
            Monthly History
        </button>
    </div>

    <!-- TODAY'S ATTENDANCE TAB -->
    <div *ngIf="activeTab === 'today'" class="tab-content">
        <!-- FILTERS -->
        <div class="filters-bar">
            <input type="text" placeholder="Search by staff name..." [(ngModel)]="searchQuery" (input)="applyFilters()"
                class="search-input" />
            <select [(ngModel)]="statusFilter" (change)="applyFilters()" class="filter-select">
                <option value="">All Status</option>
                <option value="Present">Present</option>
                <option value="Absent">Absent</option>
                <option value="Leave">Leave</option>
            </select>
        </div>

        <!-- ATTENDANCE TABLE -->
        <div class="card">
            <div class="table-container">
                <table *ngIf="filteredStaff.length > 0; else emptyState">
                    <thead>
                        <tr>
                            <th>Staff Name</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Check-In Time</th>
                            <th>Check-Out Time</th>
                            <th>Working Hours</th>
                            <th>Remarks</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let staff of filteredStaff"
                            [class.highlight-missing]="isMissingCheckout(staff._id!)">
                            <!-- Staff Name -->
                            <td>
                                <div class="staff-info">
                                    <div class="staff-avatar">{{ getInitials(staff.name) }}</div>
                                    <span class="staff-name">{{ staff.name }}</span>
                                </div>
                            </td>

                            <!-- Role -->
                            <td>
                                <span class="role-badge">{{ staff.role }}</span>
                            </td>

                            <!-- Status -->
                            <td>
                                <select [(ngModel)]="attendanceRecords[staff._id!].status"
                                    (change)="onStatusChange(staff._id!)" [disabled]="!isEditing[staff._id!]"
                                    class="status-select"
                                    [class.status-present]="attendanceRecords[staff._id!].status === 'Present'"
                                    [class.status-absent]="attendanceRecords[staff._id!].status === 'Absent'"
                                    [class.status-leave]="attendanceRecords[staff._id!].status === 'Leave'">
                                    <option value="Present">Present</option>
                                    <option value="Absent">Absent</option>
                                    <option value="Leave">Leave</option>
                                </select>
                            </td>

                            <!-- Check-In Time -->
                            <td>
                                <input type="time" [(ngModel)]="attendanceRecords[staff._id!].checkInTime"
                                    (change)="calculateWorkingHours(staff._id!)"
                                    [disabled]="!isEditing[staff._id!] || attendanceRecords[staff._id!].status !== 'Present'"
                                    class="time-input" />
                            </td>

                            <!-- Check-Out Time -->
                            <td>
                                <input type="time" [(ngModel)]="attendanceRecords[staff._id!].checkOutTime"
                                    (change)="calculateWorkingHours(staff._id!)"
                                    [disabled]="!isEditing[staff._id!] || attendanceRecords[staff._id!].status !== 'Present'"
                                    class="time-input" />
                            </td>

                            <!-- Working Hours -->
                            <td>
                                <span class="working-hours" [class.text-warning]="getWorkingHours(staff._id!) > 8">
                                    {{ getWorkingHours(staff._id!) || '-' }}
                                    <span *ngIf="getWorkingHours(staff._id!)">hrs</span>
                                </span>
                            </td>

                            <!-- Remarks -->
                            <td>
                                <input type="text" [(ngModel)]="attendanceRecords[staff._id!].remarks"
                                    [disabled]="!isEditing[staff._id!]" placeholder="Add remarks..."
                                    class="remarks-input" />
                            </td>

                            <!-- Actions -->
                            <td>
                                <div class="action-buttons">
                                    <button *ngIf="!isEditing[staff._id!]" class="btn-icon btn-secondary"
                                        (click)="toggleEdit(staff._id!)" title="Edit">
                                        <span class="material-icons">edit</span>
                                    </button>
                                    <button *ngIf="isEditing[staff._id!]" class="btn-icon btn-primary"
                                        (click)="saveAttendance(staff._id!)" title="Save">
                                        <span class="material-icons">save</span>
                                    </button>
                                    <button *ngIf="isEditing[staff._id!]" class="btn-icon btn-secondary"
                                        (click)="cancelEdit(staff._id!)" title="Cancel">
                                        <span class="material-icons">close</span>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- EMPTY STATE -->
                <ng-template #emptyState>
                    <div class="empty-state">
                        <span class="material-icons empty-icon">people_outline</span>
                        <h3>No staff records found</h3>
                        <p>{{ searchQuery || statusFilter ? 'Try adjusting your filters' : 'Add staff members to start
                            tracking attendance' }}</p>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>

    <!-- MONTHLY HISTORY TAB -->
    <div *ngIf="activeTab === 'history'" class="tab-content">
        <div class="card">
            <div class="history-controls">
                <select [(ngModel)]="selectedMonth" (change)="loadMonthlyHistory()" class="month-select">
                    <option *ngFor="let month of months" [value]="month.value">{{ month.label }}</option>
                </select>
            </div>

            <div class="history-grid">
                <div *ngFor="let staff of staffList" class="history-card">
                    <div class="history-header">
                        <div class="staff-info">
                            <div class="staff-avatar">{{ getInitials(staff.name) }}</div>
                            <div>
                                <h4>{{ staff.name }}</h4>
                                <p class="text-muted">{{ staff.role }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="history-stats">
                        <div class="stat-item">
                            <span class="stat-label">Total Days Present</span>
                            <span class="stat-value text-success">{{ getMonthlyStats(staff._id!).present }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Leaves</span>
                            <span class="stat-value text-warning">{{ getMonthlyStats(staff._id!).leaves }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Absent</span>
                            <span class="stat-value text-danger">{{ getMonthlyStats(staff._id!).absent }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Overtime Hours</span>
                            <span class="stat-value text-accent">{{ getMonthlyStats(staff._id!).overtime }} hrs</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CUSTOM STYLES FOR THIS COMPONENT -->
<style>
    /* Date Picker */
    .date-picker {
        padding: 0.625rem 1rem;
        background-color: var(--bg-input);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        color: var(--text-primary);
        font-size: var(--font-size-sm);
        cursor: pointer;
    }

    /* Tabs */
    .tabs-container {
        display: flex;
        gap: var(--space-sm);
        margin-bottom: var(--space-lg);
        border-bottom: 1px solid var(--border-subtle);
    }

    .tab-btn {
        padding: var(--space-md) var(--space-lg);
        background: transparent;
        border: none;
        color: var(--text-secondary);
        font-weight: var(--font-weight-semibold);
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: var(--transition-fast);
    }

    .tab-btn:hover {
        color: var(--text-primary);
    }

    .tab-btn.active {
        color: var(--accent-primary);
        border-bottom-color: var(--accent-primary);
    }

    /* Filters */
    .filters-bar {
        display: flex;
        gap: var(--space-md);
        margin-bottom: var(--space-lg);
    }

    .filter-select {
        min-width: 150px;
    }

    /* Staff Info */
    .staff-info {
        display: flex;
        align-items: center;
        gap: var(--space-md);
    }

    .staff-avatar {
        width: 36px;
        height: 36px;
        border-radius: var(--radius-full);
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-hover));
        color: var(--text-inverse);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: var(--font-weight-bold);
        font-size: var(--font-size-sm);
    }

    .staff-name {
        font-weight: var(--font-weight-semibold);
    }

    /* Role Badge */
    .role-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        background-color: var(--bg-hover);
        color: var(--text-secondary);
        border-radius: var(--radius-md);
        font-size: var(--font-size-xs);
        font-weight: var(--font-weight-medium);
    }

    /* Status Select */
    .status-select {
        padding: 0.5rem;
        border-radius: var(--radius-md);
        font-weight: var(--font-weight-semibold);
        font-size: var(--font-size-sm);
        border: 1px solid transparent;
    }

    .status-select.status-present {
        background-color: rgba(16, 185, 129, 0.15);
        color: var(--success);
        border-color: rgba(16, 185, 129, 0.3);
    }

    .status-select.status-absent {
        background-color: rgba(239, 68, 68, 0.15);
        color: var(--danger);
        border-color: rgba(239, 68, 68, 0.3);
    }

    .status-select.status-leave {
        background-color: rgba(245, 158, 11, 0.15);
        color: var(--warning);
        border-color: rgba(245, 158, 11, 0.3);
    }

    /* Time Input */
    .time-input {
        padding: 0.5rem;
        background-color: var(--bg-input);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        color: var(--text-primary);
        font-size: var(--font-size-sm);
        width: 120px;
    }

    .time-input:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Working Hours */
    .working-hours {
        font-weight: var(--font-weight-semibold);
        color: var(--success);
    }

    /* Remarks Input */
    .remarks-input {
        padding: 0.5rem;
        background-color: var(--bg-input);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        color: var(--text-primary);
        font-size: var(--font-size-sm);
        width: 100%;
        min-width: 150px;
    }

    .remarks-input:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: var(--space-xs);
    }

    /* Highlight Missing Checkout */
    .highlight-missing {
        background-color: rgba(245, 158, 11, 0.05);
        border-left: 3px solid var(--warning);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: var(--space-2xl);
    }

    .empty-icon {
        font-size: 4rem;
        color: var(--text-muted);
        margin-bottom: var(--space-md);
    }

    .empty-state h3 {
        color: var(--text-secondary);
        margin-bottom: var(--space-sm);
    }

    .empty-state p {
        color: var(--text-muted);
    }

    /* History Controls */
    .history-controls {
        margin-bottom: var(--space-lg);
    }

    .month-select {
        min-width: 200px;
    }

    /* History Grid */
    .history-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: var(--space-lg);
    }

    .history-card {
        background-color: var(--bg-hover);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: var(--space-lg);
        transition: var(--transition-normal);
    }

    .history-card:hover {
        border-color: var(--accent-primary);
        transform: translateY(-2px);
    }

    .history-header {
        margin-bottom: var(--space-lg);
        padding-bottom: var(--space-md);
        border-bottom: 1px solid var(--border-subtle);
    }

    .history-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-md);
    }

    .stat-item {
        display: flex;
        flex-direction: column;
        gap: var(--space-xs);
    }

    .stat-label {
        font-size: var(--font-size-xs);
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .stat-value {
        font-size: var(--font-size-xl);
        font-weight: var(--font-weight-bold);
    }

    /* Responsive */
    @media (max-width: 768px) {
        .filters-bar {
            flex-direction: column;
        }

        .history-grid {
            grid-template-columns: 1fr;
        }

        .table-container {
            overflow-x: auto;
        }
    }
</style>