<div class="app-shell">
    <!-- Sidebar Component -->
    <app-sidebar [isOpen]="isSidebarOpen"></app-sidebar>

    <main class="main-content">
        <!-- Modern Glassmorphism Topbar -->
        <header class="topbar glass shadow-glass" style="z-index: 100;">
            <div class="flex items-center gap-md">
                <button (click)="toggleSidebar()" class="btn btn-icon btn-secondary"
                    style="border: none; background: rgba(255,255,255,0.05);">
                    <span class="material-icons">menu</span>
                </button>
                <div class="h-8 w-[1px] bg-border-subtle mx-sm" style="background: var(--border-subtle);"></div>
                <app-gym-selector></app-gym-selector>
            </div>

            <div class="flex items-center gap-lg">
                <!-- Notifications -->
                <div class="relative">
                    <button (click)="toggleNotifications()" class="btn btn-icon btn-secondary"
                        style="border: none; background: rgba(255,255,255,0.05); position: relative;">
                        <span class="material-icons">notifications</span>
                        <span *ngIf="(unreadCount$ | async) ?? 0 > 0"
                            class="absolute top-1 right-1 w-2 h-2 bg-danger rounded-full"
                            style="background: var(--danger); border-radius: 50%;"></span>
                    </button>

                    <!-- Floating Notification Card (Controlled) -->
                    <div *ngIf="showNotifications" class="absolute right-[-10px] top-full mt-3 w-80 z-50 animate-fadeIn"
                        (mouseleave)="showNotifications = false">
                        <div class="card p-0 shadow-hover glass-dark"
                            style="max-height: 450px; overflow: hidden; border: 1px solid var(--accent-soft); border-radius: var(--radius-lg);">
                            <app-notification-center></app-notification-center>
                        </div>
                    </div>
                </div>

                <!-- Profile Action -->
                <button (click)="onLogout()" class="btn btn-outline"
                    style="border-radius: var(--radius-full); padding: 0.5rem 1.5rem; display: flex; align-items: center; gap: var(--space-sm);">
                    <span class="material-icons" style="font-size: 1.2rem;">logout</span>
                    <span>Sign Out</span>
                </button>
            </div>
        </header>

        <!-- Main Page Container -->
        <div class="page-container scroll-smooth"
            style="background: radial-gradient(circle at top right, rgba(212, 175, 55, 0.03), transparent 40%);">
            <router-outlet></router-outlet>
        </div>
    </main>
</div>

<!-- Toast Notifications -->
<app-toast></app-toast>

<!-- Confirmation Dialog -->
<app-confirm-dialog></app-confirm-dialog>

<!-- Member Info Modal -->
<app-member-info-modal></app-member-info-modal>