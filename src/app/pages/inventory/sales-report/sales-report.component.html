<div class="page-container fade-in">
    <!-- Header -->
    <div class="page-header flex justify-between items-center mb-lg">
        <div>
            <h1 class="page-title">POS Reports</h1>
            <p class="page-subtitle">Sales performance and insights</p>
        </div>

        <div class="flex gap-md items-center">
            <form [formGroup]="filterForm" class="flex gap-sm items-center">
                <input type="date" formControlName="date" class="form-control w-auto">
                <button type="button" class="btn btn-primary" (click)="loadReport()">
                    <span class="material-icons text-sm mr-1">refresh</span> Refresh
                </button>
            </form>
            <button class="btn btn-secondary" (click)="exportCSV()">
                <span class="material-icons text-sm mr-1">download</span> Export CSV
            </button>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex justify-center items-center py-xl">
        <div class="text-center">
            <span class="material-icons text-4xl text-primary animate-spin mb-2">refresh</span>
            <p class="text-secondary">Loading report data...</p>
        </div>
    </div>

    <!-- Main Content -->
    <div *ngIf="!isLoading && salesData">
        <!-- Summary Cards -->
        <div class="grid grid-4 mb-lg">
            <!-- Total Revenue -->
            <div class="card stat-card">
                <div class="stat-icon bg-success-soft text-success">
                    <span class="material-icons">attach_money</span>
                </div>
                <div>
                    <p class="text-secondary text-sm mb-1">Total POS Revenue</p>
                    <h3 class="mb-0 text-success">{{ totalRevenue | currency }}</h3>
                </div>
            </div>

            <!-- Total Transactions -->
            <div class="card stat-card">
                <div class="stat-icon bg-info-soft text-info">
                    <span class="material-icons">receipt_long</span>
                </div>
                <div>
                    <p class="text-secondary text-sm mb-1">Total Transactions</p>
                    <h3 class="mb-0">{{ totalTxns }}</h3>
                </div>
            </div>

            <!-- Gross Profit -->
            <div class="card stat-card">
                <div class="stat-icon bg-accent-soft text-accent">
                    <span class="material-icons">trending_up</span>
                </div>
                <div>
                    <p class="text-secondary text-sm mb-1">Gross Profit</p>
                    <h3 class="mb-0 text-accent">{{ grossProfit | currency }}</h3>
                </div>
            </div>

            <!-- Profit Margin -->
            <div class="card stat-card">
                <div class="stat-icon bg-primary-soft text-primary">
                    <span class="material-icons">percent</span>
                </div>
                <div>
                    <p class="text-secondary text-sm mb-1">Profit Margin</p>
                    <h3 class="mb-0">{{ profitMargin | number:'1.1-1' }}%</h3>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-2 mb-lg gap-lg">
            <!-- Daily Sales Chart -->
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Daily Sales by Hour</h4>
                </div>
                <div class="chart-container">
                    <canvas baseChart [data]="hourlyChartData" [options]="hourlyChartOptions" type="bar">
                    </canvas>
                </div>
            </div>

            <!-- Monthly Trend -->
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Revenue vs Profit Trend</h4>
                </div>
                <div class="chart-container">
                    <canvas baseChart [data]="trendChartData" [options]="trendChartOptions" type="line">
                    </canvas>
                </div>
            </div>
        </div>

        <!-- Data Tables Section -->
        <div class="grid grid-2 mb-lg gap-lg">
            <!-- Product-wise Performance -->
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Top Selling Products</h4>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th class="text-right">Qty Sold</th>
                                <th class="text-right">Revenue</th>
                                <th class="text-right">Profit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let product of productStats; let i = index" [class.highlight-row]="i < 3">
                                <td>
                                    <div class="flex items-center gap-2">
                                        <span class="rank-badge" *ngIf="i < 3">{{ i + 1 }}</span>
                                        <span class="font-medium">{{ product.name }}</span>
                                    </div>
                                </td>
                                <td class="text-right font-mono">{{ product.qty }}</td>
                                <td class="text-right font-mono text-success">{{ product.revenue | currency }}</td>
                                <td class="text-right font-mono text-accent">{{ product.profit | currency }}</td>
                            </tr>
                            <tr *ngIf="productStats.length === 0">
                                <td colspan="4" class="text-center text-muted py-md">No product data available</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Staff-wise Performance -->
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Staff Performance</h4>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Staff Name</th>
                                <th class="text-right">Transactions</th>
                                <th class="text-right">Total Sales</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let staff of staffStats; let i = index" [class.highlight-row]="i === 0">
                                <td>
                                    <div class="flex items-center gap-2">
                                        <span class="material-icons text-sm text-muted">person</span>
                                        <span class="font-medium">{{ staff.name }}</span>
                                        <span class="badge badge-success text-xs" *ngIf="i === 0">Top Performer</span>
                                    </div>
                                </td>
                                <td class="text-right font-mono">{{ staff.transactions }}</td>
                                <td class="text-right font-mono text-success">{{ staff.sales | currency }}</td>
                            </tr>
                            <tr *ngIf="staffStats.length === 0">
                                <td colspan="3" class="text-center text-muted py-md">No staff data available</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && !salesData" class="card text-center py-xl">
        <span class="material-icons text-6xl text-muted mb-md opacity-50">assessment</span>
        <h3 class="text-muted mb-2">No POS sales data available</h3>
        <p class="text-secondary">Select a different date range or check back later.</p>
    </div>
</div>